<!DOCTYPE html>

<html xmlns:th="http://www.thymeleaf.org">
<div th:replace="~{top::menu}"></div>
<style>
  p{color:red;}

</style>
<body>
<head>

</head>

<div class="container">
  <form th:action="@{/UserUpdateSave}" method="post" th:object="${dto}" enctype="multipart/form-data">
    <input type="hidden" name="userId" th:value="${dto.userId}">
    <input type="hidden" name="dfname" th:value="${userDTO.profileimgName}" />
    <input type="hidden" name="email" id="fullEmail" />
    <input type="hidden" name="phoneCheckStatus" id="phoneCheckStatus" value="false" />

    <div class="form-group">
      <label for="userLoginId">아이디</label>
      <input type="text" class="form-control" id="userLoginId" name="userLoginId" th:value="${dto.userLoginId}" readonly>
    </div>

    <div class="form-group">
      <label for="name">이름</label>
      <input type="text" class="form-control" id="name" th:field="*{name}" th:value="${dto.name}" required>
      <div th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></div>
    </div>


    <div class="form-group">
      <label for="phone">전화번호</label>
      <input type="text" id="phone" name="phone" placeholder="전화번호는 010으로 시작하는 숫자 11자리여야 합니다."
             maxlength="13" oninput="autoFormatPhone(this)"  required />
      <div th:if="${#fields.hasErrors('phone')}" th:errors="*{phone}"></div>
    </div>


    <div class="form-group">
      <label for="emailId">이메일</label>
      <input type="text" class="form-control" id="emailId" name="emailId" th:value="${dto.emailId}" required> @
      <select name="emailDomain" id="emailDomain" th:value="${dto.emailDomain}" required>
        <option value="gmail.com">gmail.com</option>
        <option value="naver.com">naver.com</option>
        <option value="daum.net">daum.net</option>
        <option value="etc">직접입력</option>
      </select>
      <input type="text" class="form-control" id="customDomain" name="customDomain" style="display:none;" placeholder="도메인 입력">
    </div>

    <div class="form-group">
      <label for="profileimg">프로필이미지</label>
      <img th:src="@{/image/}+${dto.profileimg}" width="300px" height="300px">
      <input type="file" class="form-control" id="profileimg" name="profileimg" th:value="${dto.profileimg}">
      <input type="hidden" class="form-control" id="himage" name="dfname" th:value="${dto.profileimg}">
    </div>

    <button type="submit" class="btn btn-primary">수정</button>
    <button type="reset" class="btn btn-primary" onclick="location.href='redirect:/'">취소</button>
  </form>
</div>

<!-- 도메인 선택 시 직접 입력 필드 보이기/숨기기 -->

<!-- 전화번호 유효성 검사 -->
<script>
  function autoFormatPhone(input) {
    let value = input.value.replace(/[^0-9]/g, "");

    // 010 자동 시작
    if (!value.startsWith("010")) {
      value = "010" + value;
    }

    if (value.length <= 3) {
      input.value = value;
    } else if (value.length <= 7) {
      input.value = value.slice(0, 3) + "-" + value.slice(3);
    } else if (value.length <= 11) {
      input.value = value.slice(0, 3) + "-" + value.slice(3, 7) + "-" + value.slice(7);
    } else {
      input.value = value.slice(0, 3) + "-" + value.slice(3, 7) + "-" + value.slice(7, 11);
    }
  }
</script>

<!-- 이메일 도메인 선택 -->
<script>
  document.addEventListener("DOMContentLoaded", function() {
      const domainSelect = document.getElementById("emailDomain");
      const customInput = document.getElementById("emailCustom");

      if (domainSelect && customInput) {
          domainSelect.addEventListener("change", function () {
              if (this.value === "direct") {
                  customInput.style.display = "inline-block";
                  customInput.required = true;
              } else {
                  customInput.style.display = "none";
                  customInput.required = false;
              }
          });
      }
  });
</script>

<!--서버 전송시 이메일 합쳐서 보내기 -->
<script>
  document.getElementById("findIdForm").addEventListener("submit", function (e) {
      const id = document.getElementById("emailId").value;
      const domain = document.getElementById("emailDomain").value === "direct"
          ? document.getElementById("emailCustom").value
          : document.getElementById("emailDomain").value;

      if (domain === "direct" && document.getElementById("emailCustom").value.trim() === "") {
          alert("이메일 도메인을 입력해 주세요.");
          e.preventDefault(); // 폼 제출 막기
          return false; // 폼 전송을 막고 경고 표시
      }

      // 합쳐서 이메일을 폼에 추가
      document.getElementById("fullEmail").value = id + "@" + domain;
  });
</script>


</body>

</html>