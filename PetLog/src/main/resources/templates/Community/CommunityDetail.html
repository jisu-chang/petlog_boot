<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Í≤åÏãúÍ∏Ä ÏÉÅÏÑ∏Î≥¥Í∏∞</title>
    <style>
        body {
            font-family: 'Pretendard', sans-serif;
            background-color: #fff6f6;
            color: #333;
            margin: 0;
            padding: 0;
        }

        .container {
            width: 90%;
            max-width: 1000px;
            margin: 40px auto;
            background-color: #fff;
            padding: 30px 40px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        h2 {
            color: #f48aa5;
            text-align: center;
            font-size: 2em;
            margin-bottom: 30px;
        }

        .post-header {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
        }

        .profile-img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 12px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        th, td {
            padding: 14px 18px;
            text-align: left;
            font-size: 1em;
            vertical-align: top;
        }

        th {
            width: 120px;
            background-color: #ffeef2;
            color: #555;
            text-align: center;
        }

        .post-content {
            white-space: pre-line;
            padding: 15px;
            background-color: #fafafa;
            border: 1px solid #eee;
            border-radius: 6px;
            min-height: 300px;
        }

        .post-content img {
            width: 100%;
            max-width: 500px;
            margin-top: 20px;
            border-radius: 8px;
        }

        .btn-group {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }

        .btn-group input[type="button"] {
            color: #333;
            border: none;
            padding: 8px 20px;
            border-radius: 10px;
            cursor: pointer;
        }

        .btn-group .list-btn {
            background-color: #eeeeee;
        }

        .btn-group .edit-delete {
            background-color: #ffe1e1;
        }

        .btn-group input[type="button"]:hover {
            background-color: #ddd;
        }

        .like-button {
            font-size: 22px;
            background: none;
            border: none;
            cursor: pointer;
        }

        .like-button.liked {
            color: red;
        }

        .top-icons {
            text-align: right;
            margin-bottom: 10px;
        }

        .comment-box {
            background-color: #fff;
            padding: 20px;
            border-radius: 12px;
            margin-top: 30px;
        }

        .comment-form textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 8px;
        }

        .comment-form button {
            background-color: #ffe1e1;
            color: #333;
            border: none;
            border-radius: 10px;
            padding: 8px 16px;
            cursor: pointer;
            margin-top: 10px;
        }

        .comment {
            border-top: 1px solid #eee;
            padding-top: 10px;
            margin-top: 10px;
        }

    </style>
</head>
<body>
<div th:replace="~{top::menu}"></div>
<div class="container">
    <div class="post-header">
        <img class="profile-img" th:if="${dto?.user?.profileimg != null}" th:src="@{/images/{img}(img=${dto.user.profileimg})}" alt="Profile Image"/>
        <img class="profile-img" th:if="${dto?.user?.profileimg == null}" th:src="@{/images/default.png}" alt="Default Image"/>
        <h2 th:text="${dto.user.userLoginId} + 'ÎãòÏùò Í≤åÏãúÎ¨º'"></h2>
    </div>

    <div class="top-icons">
        <span>üëÅ <span th:text="${dto.postReadcnt}"></span></span>
        <span style="margin-left: 10px;">üí¨ <span th:text="${#lists.size(comments)}"></span></span>
        <span style="margin-left: 10px;">‚ù§Ô∏è <span th:text="${likeCount}"></span></span>
    </div>

    <table>
        <tr>
            <th>Ï†úÎ™©</th>
            <td><div class="form-group">
                <div style="white-space: pre-line;" th:text="${dto.postTitle}">
                </div>
            </div>
            </td>
        </tr>
        <tr>
            <th>ÏûëÏÑ±Ïûê</th>
            <td><div class="form-group">
                <div style="white-space: pre-line;" th:text="${dto.user.userLoginId}">
                </div>
            </div>
            </td>
        </tr>
        <tr>
            <th>Í≤åÏãúÏùº</th>
            <td><div class="form-group">
                <div style="white-space: pre-line;" th:text="${dto.postDate}">
                </div>
            </div>
            </td>
        </tr>
        <tr>
            <th>ÎÇ¥Ïö©</th>
            <td>
                <div class="post-content">
                    <span th:text="${dto.postContent}"></span>
                    <div th:if="${dto.postImage != null and !#strings.isEmpty(dto.postImage)}" style="margin-top: 20px; text-align: center;">
                        <img th:src="@{'/image/' + ${dto.postImage}}" />
                    </div>
                </div>
            </td>
        </tr>
    </table>

    <div class="btn-group">
        <input type="button" class="list-btn" value="Î™©Î°ù" onclick="location.href='/CommunityOut'">
        <th:block th:if="${#authentication.principal.userId == dto.user.userId || #authentication.principal.userRole == 'admin'}">
            <input type="button" class="edit-delete" value="ÏàòÏ†ï" onclick="location.href='/CommunityUpdate?unum=' + [[${dto.postId}]]">
            <input type="button" class="edit-delete" value="ÏÇ≠Ï†ú" onclick="if(confirm('ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) location.href='/CommunityDelete?dnum=' + [[${dto.postId}]]">
        </th:block>
    </div>

    <form th:action="@{'/post/' + ${dto.postId} + '/like'}" method="post" style="text-align:center; margin-top: 10px;">
        <button type="submit" th:classappend="${likedByUser} ? 'like-button liked' : 'like-button'">
            <span th:text="${likedByUser ? '‚ù§Ô∏è' : 'ü§ç'} + ' (' + ${likeCount} + ')'">Ï¢ãÏïÑÏöî</span>
        </button>
    </form>

    <div class="comment-box">
        <h3>üí¨ ÎåìÍ∏Ä</h3>
        <form class="comment-form" th:action="@{/community/comment}" method="post">
            <input type="hidden" name="post_id" th:value="${dto.postId}" />
            <input type="hidden" name="parent_id" value="0" />
            <input type="hidden" name="depth" value="0" />
            <textarea name="com_com" rows="3" placeholder="ÎåìÍ∏ÄÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî" required></textarea>
            <button type="submit">ÎåìÍ∏Ä ÏûëÏÑ±</button>
        </form>

        <div th:each="comment : ${comments}" class="comment">
            <p><strong th:text="${comment.userLoginId}">ÏûëÏÑ±Ïûê</strong>: <span th:text="${comment.com_com}">ÎÇ¥Ïö©</span></p>
            <button type="button" onclick="toggleReplyForm([[${comment.com_id}]])">ÎãµÍ∏Ä</button>

            <div th:each="reply : ${comments}" th:if="${reply.parent_id == comment.com_id}" style="margin-left: 20px;">
                ‚Ü≥ <strong th:text="${reply.userLoginId}">ÏûëÏÑ±Ïûê</strong>: <span th:text="${reply.com_com}">ÎåÄÎåìÍ∏ÄÎÇ¥Ïö©</span>
            </div>

            <form th:id="'reply-form-' + ${comment.com_id}" class="comment-form" th:action="@{/community/comment}" method="post" style="display: none;">
                <input type="hidden" name="post_id" th:value="${dto.postId}" />
                <input type="hidden" name="parent_id" th:value="${comment.com_id}" />
                <input type="hidden" name="depth" value="1" />
                <textarea name="com_com" rows="2" placeholder="ÎãµÍ∏ÄÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî" required></textarea>
                <button type="submit">ÏûëÏÑ±</button>
            </form>
        </div>
    </div>
</div>
<script>
    function toggleReplyForm(id) {
        const form = document.getElementById('reply-form-' + id);
        if (form) form.style.display = form.style.display === 'block' ? 'none' : 'block';
    }
</script>
</body>
</html>
