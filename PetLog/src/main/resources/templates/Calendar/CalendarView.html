<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<div th:replace="~{top::menu}"></div>
<head>
    <meta charset="UTF-8">
    <title th:text="${current_year} + 'ÎÖÑ ' + ${current_month} + 'Ïõî'">Îã¨Î†•</title>
    <style>
        body {
          margin: 0; padding: 0;
          font-family: 'Pretendard', sans-serif;
        }
        .calendar-wrapper {
          max-width: 1400px;
          margin: 0 auto;
          padding: 0 20px;
        }
        table {
          width: 100%;
          border-collapse: separate;
          border-spacing: 4px;
          font-size: 1.7rem;
        }
        th {
          background-color: #f3e5f5;
          color: #444;
          font-weight: bold;
          padding: 10px 0;
          text-align: center;
          border: 1px solid #d0d0d0;
          border-radius: 10px;
        }
        th.sun { color: #f48b94; }
        th.sat { color: #8bb3f4; }

        td {
          padding: 0;
          height: 120px;
        }

        .calendar-cell {
          background-color: rgba(255, 255, 255, 0.6);
          backdrop-filter: blur(3px);
          -webkit-backdrop-filter: blur(3px);
          border-radius: 12px;
          padding: 0;
          margin: 4px;
          height: 120px;
          position: relative;
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
          border: 1px solid rgba(255, 255, 255, 0.3);
          vertical-align: top;
          overflow: hidden;
        }

        .cell-content {
          height: 100%;
          overflow-y: auto;
          padding: 6px;
          box-sizing: border-box;
          text-align: left;
        }

        .date-number {
          font-weight: bold;
          color: #ff8a80;
          font-size: 1.7rem;
          margin-bottom: 8px;
          display: block;
        }

        .schedule-item {
          background-color: #ffe0ec;
          font-size: 1.3rem;
          padding: 6px 10px;
          margin-top: 6px;
          border-radius: 12px;
          overflow: hidden;
          white-space: nowrap;
          text-overflow: ellipsis;
          box-shadow: 0 1px 3px rgba(0,0,0,0.1);
          display: block;
        }

        .sun { color: #f48b94; }
        .sat { color: #8bb3f4; }
        .weekday { color: #555; }

        .today {
          display: inline-block;
          background-color: #fff3c4;
          border: 1px solid #ffcc80;
          border-radius: 8px;
          padding: 2px 6px;
          font-weight: bold;
          color: #444;
        }

        .today-label {
          font-size: 12px;
          color: #f6b9b9;
          margin-left: 6px;
        }

        .pet-label {
          font-size: 1.3rem;
          font-weight: bold;
          margin-right: 8px;
        }

        .pet-select {
          font-size: 1.2rem;
          padding: 8px 14px;
          border-radius: 10px;
          background-color: #fff0f5;
          border: 1px solid #ccc;
          color: #333;
        }

        .schedule-add-btn {
          font-size: 1.2rem;
          padding: 10px 18px;
          margin-left: 10px;
          background-color: #ffd1dc;
          border-radius: 14px;
          font-weight: bold;
          cursor: pointer;
          border: none;
          box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .month-nav {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin: 9px auto;
          padding: 0 20px;
          max-width: 1200px;
        }

        .nav-btn {
          font-size: 1.1rem;
          padding: 8px 16px;
          background-color: #fff3c4;
          border: 1px solid #ffcc80;
          color: #333;
          border-radius: 12px;
          text-decoration: none;
          font-weight: bold;
        }

        .modal {
          position: fixed;
          top: 0; left: 0;
          width: 100vw; height: 100vh;
          background: rgba(0, 0, 0, 0.3);
          display: none;
          justify-content: center;
          align-items: center;
          z-index: 9999;
        }

        .modal-box-summary {
          background-color: #e6fbf6;
          padding: 36px 28px;
          border-radius: 20px;
          width: 420px;
          box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }

        .modal-box-summary h3 {
          font-size: 22px;
          color: #6ac9bb;
          margin-bottom: 18px;
          text-align: center;
        }

        .modal-box-summary label {
          display: block;
          font-weight: bold;
          margin-top: 4px;
          margin-bottom: 1px;
          color: #444;
          font-size: 14px;
        }

        .modal-box-summary input[type="text"],
        .modal-box-summary input[type="date"],
        .modal-box-summary select,
        .modal-box-summary textarea {
          width: 100%;
          margin-top: 6px;
          padding: 8px 12px;
          margin-bottom: 4px;
          font-size: 15px;
          border: 1px solid #ddd;
          border-radius: 10px;
          background: #fffefe;
          box-sizing: border-box;
        }

        .modal-box-summary textarea {
          resize: vertical;
          height: 70px;
        }

        .modal-box-summary .submit-btn {
          background-color: #88ddd0;
          color: white;
          border: none;
          padding: 12px 24px;
          border-radius: 10px;
          font-size: 15px;
          font-weight: bold;
          margin-top: 6px;
          width: 100%;
        }

        .close-btn {
          position: absolute;
          top: 14px;
          right: 18px;
          font-size: 20px;
          background: none;
          border: none;
          cursor: pointer;
          color: #aaa;
        }

    </style>
</head>
<body>

<div style="text-align: center; margin-bottom: 20px;">
    <h2 th:text="${current_year} + 'ÎÖÑ ' + ${current_month} + 'Ïõî'"></h2>

    <form method="get" th:action="@{/Calendar/CalendarView}" style="display: inline-block;">
        <label>üê∂ Î∞òÎ†§ÎèôÎ¨º ÏÑ†ÌÉù: </label>
        <select name="pet_id" class="pet-select" onchange="this.form.submit()">
            <option th:each="pet : ${petlist}"
                    th:value="${pet.petId}"
                    th:text="${pet.petName}"
                    th:selected="${param.pet_id} == ${pet.petId}"></option>
        </select>
        <input type="hidden" name="year" th:value="${current_year}" />
        <input type="hidden" name="month" th:value="${current_month}" />
    </form>

    <div style="margin-top: 16px;">
        <button type="button" class="schedule-add-btn" onclick="openAddScheduleModal()">‚ûï ÏùºÏ†ï Ï∂îÍ∞Ä</button>
    </div>
</div>

<div class="month-nav">
    <a th:href="@{/Calendar/CalendarView(year=${prevYear}, month=${prevMonth}, pet_id=${param.pet_id})}" class="nav-btn">‚óÄ Ïù¥Ï†Ñ Îã¨</a>
    <a th:href="@{/Calendar/CalendarView(year=${nextYear}, month=${nextMonth}, pet_id=${param.pet_id})}" class="nav-btn">Îã§Ïùå Îã¨ ‚ñ∂</a>
</div>

<div class="calendar-wrapper">
    <table>
        <tr>
            <th class="sun">Sun</th><th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th><th>Fri</th><th class="sat">Sat</th>
        </tr>
        <tbody th:utext="${calendarHtml}"></tbody> <!-- ‚úÖ ÌïµÏã¨: tbodyÎ°ú Ï∂úÎ†• -->
    </table>
</div>

<!-- ÏùºÏ†ï Ï∂îÍ∞Ä Î™®Îã¨ -->
<div id="addScheduleModal" class="modal">
    <div class="modal-box-summary">
        <button class="close-btn" onclick="closeAddScheduleModal()">√ó</button>
        <h3>ÏùºÏ†ï Ï∂îÍ∞Ä</h3>
        <form th:action="@{/Calendar/CalendarInput}" method="post">
            <label>Î∞òÎ†§ÎèôÎ¨º
                <select name="pet_id" required>
                    <option value="">ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>
                    <option th:each="pet : ${petlist}" th:value="${pet.petId}" th:text="${pet.petName}"></option>
                </select>
            </label><br>

            <label>Ï†úÎ™©
                <input type="text" name="cal_title" placeholder="Ï†úÎ™© ÏûÖÎ†•" required />
            </label><br>

            <label>ÎÇ¥Ïö©
                <textarea name="cal_content" rows="3" placeholder="ÎÇ¥Ïö© ÏûÖÎ†•" required></textarea>
            </label><br>

            <label>ÎÇ†Ïßú
                <input type="date" name="cal_date" required />
            </label><br>

            <button type="submit" class="submit-btn">Ï†ÄÏû•</button>
        </form>
    </div>
</div>

<script>
    function openAddScheduleModal() {
      document.getElementById("addScheduleModal").style.display = "flex";
    }
    function closeAddScheduleModal() {
      document.getElementById("addScheduleModal").style.display = "none";
    }
    window.onclick = function(event) {
      const modal = document.getElementById("addScheduleModal");
      if (event.target === modal) {
        modal.style.display = "none";
      }
    }
</script>

</body>
</html>
